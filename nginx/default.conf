http {
resolver 127.0.0.11 ipv6=off;
# ... rest of http config
}

upstream client {
    server client:3000;
}

upstream api {
    server api:5000;
}

server {
    listen 80;

    location / {
        proxy_pass http://client;
    }

    #only used in development
    location /ws {
        proxy_pass http://client;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";

    }

    location /api/ {
      rewrite ^/api/(.*)$ /$1 break; 
      proxy_pass http://api/;  
    }

    location ~ /\.(?!well-known) {
    deny all;
    return 404;
    }

    location ~* (composer\.json|composer\.lock|package\.json|package-lock\.json|yarn\.lock|Dockerfile|docker-compose\.yml|\.env.*|\.aws/.*|id_rsa|config\.ini|application\.ini|wp-config\.php.*|settings\.php\.bak) {
        deny all;
        return 404;
    }
}